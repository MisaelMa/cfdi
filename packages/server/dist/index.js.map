{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["// import * as path from 'path';\n\nimport {\n  CFDI,\n  Comprobante,\n  Concepts,\n  Emisor,\n  Impuestos,\n  ObjetoImpEnum,\n  Receptor,\n  Relacionado,\n} from \"@cfdi/xml\"\nimport express, { Request, Response } from 'express'\n\n// import { sum } from '@recreando/xml';\nconst sum = (a: number, b: number) => {\n  return a + b\n}\nimport { wrapAsync } from './utils/wrapAsync';\n\n// Create a new express app instance\nconst app = express();\napp.get('/sum', (req: Request, res: Response) => {\n  console.log(req.query);\n  const d = sum(1, 1);\n  console.log(d);\n  res.send({ val: d });\n});\napp.get(\n  '/',\n  wrapAsync(async (req: Request, res: Response) => {\n    // const styleSheet = path.join(\n    //   path.resolve(__dirname, '..', '../'),\n    //   'resources',\n    //   '4.0',\n    //   'cadenaoriginal.xslt'\n    // );\n\n    // const pathCer = path.join(\n    //   path.resolve(__dirname, '..', 'src', 'signati'),\n    //   'certificados'\n    // );\n    // console.log(pathCer)\n    // const key = `${pathCer}/LAN7008173R5.key`;\n    // const cer = `${pathCer}/LAN7008173R5.cer`;\n    const comprobanteAttribute: Comprobante = {\n      Serie: 'E',\n      Folio: 'ACACUN-27',\n      Fecha: '2014-07-08T12:16:50',\n      Sello: '',\n      FormaPago: '01',\n      NoCertificado: '',\n      Certificado: '',\n      condicionesDePago: 'Contado',\n      SubTotal: '16148.04',\n      Descuento: '645.92',\n      Moneda: 'MXN',\n      Total: '17207.35',\n      TipoDeComprobante: 'I',\n      MetodoPago: 'PUE',\n      LugarExpedicion: 'México',\n      Exportacion: '01',\n    };\n    // const custom = {\n    //   'cfdi:Comprobante': 'comprobante',\n    // };\n    const cfd = new CFDI(comprobanteAttribute, {\n      debug: true,\n      // xslt: styleSheet,\n    });\n    await cfd.setAttributesXml({ version: '1.0', encoding: 'utf-8' });\n\n    cfd.informacionGlobal({\n      Periodicidad: '1',\n      Meses: '1',\n      Año: '2',\n    });\n    const relation = new Relacionado({ TipoRelacion: '01' });\n    relation.addRelation('asdasd-3234-asdasd-2332-asdas');\n    relation.addRelation('asdasd-3234-asdasd-2332-asdas');\n    await cfd.relacionados(relation);\n\n    const emisor = new Emisor({\n      Rfc: 'TCM970625MB1',\n      Nombre: 'FACTURACION MODERNA SA DE CV',\n      RegimenFiscal: 601,\n      FacAtrAdquirente: 'asdasd',\n    });\n    await cfd.emisor(emisor);\n\n    const receptor = new Receptor({\n      Rfc: 'XAXX010101000',\n      Nombre: 'PUBLICO EN GENERAL',\n      UsoCFDI: 'G01',\n      DomicilioFiscalReceptor: '112',\n      RegimenFiscalReceptor: '22',\n    });\n    await cfd.receptor(receptor);\n\n    const concepto = new Concepts({\n      ClaveProdServ: '001',\n      NoIdentificacion: '1212',\n      Cantidad: '2',\n      ClaveUnidad: 'pieza',\n      Unidad: 'Pieza',\n      Descripcion: 'audifonos',\n      ValorUnitario: '1000',\n      Importe: '2000',\n      Descuento: '00.0',\n      ObjetoImp: ObjetoImpEnum.NoobjetoDeimpuesto,\n    });\n    concepto.predial('000121231');\n    concepto.aduana('21  47  3807  8003832');\n    concepto.parte({\n      ClaveProdServ: '51241200',\n      NoIdentificacion: 'IM020',\n      Cantidad: 1,\n      Unidad: 'PIEZA',\n      Descripcion:\n        '25311FM00114 CREMA FUNGICIDA 35ML (ACIDO UNDECILENICO, ARBOL DEL TE VEHICULO EMOLIENTE)',\n      ValorUnitario: '172.50',\n      Importe: '172.50',\n    });\n    concepto.traslado({\n      Base: '369.83',\n      Impuesto: '002',\n      TipoFactor: 'Tasa',\n      TasaOCuota: '0.16',\n      Importe: '59.17',\n    });\n    concepto.traslado({\n      Base: '369.8aaaa3',\n      Impuesto: '002',\n      TipoFactor: 'Tasa',\n      TasaOCuota: '0.16',\n      Importe: '59.17',\n    });\n\n    concepto.retencion({\n      Base: '369.83',\n      Impuesto: '002',\n      TipoFactor: 'Tasa',\n      TasaOCuota: '0.16',\n      Importe: '59.17',\n    });\n\n    await cfd.concepto(concepto);\n\n    const concepto2 = new Concepts({\n      ClaveProdServ: '001',\n      NoIdentificacion: '1212',\n      Cantidad: '2',\n      ClaveUnidad: 'pieza',\n      Unidad: 'Pieza',\n      Descripcion: 'audifonos',\n      ValorUnitario: '1000',\n      Importe: '2000',\n      Descuento: '00.0',\n      ObjetoImp: ObjetoImpEnum.NoobjetoDeimpuesto,\n    });\n    concepto2.terceros({\n      RfcACuentaTerceros: 'JUFA7608212V6',\n      NombreACuentaTerceros: 'ADRIANA JUAREZ FERNANDEZ',\n      RegimenFiscalACuentaTerceros: '601',\n      DomicilioFiscalACuentaTerceros: '29133',\n    });\n    await cfd.concepto(concepto2);\n    const impuesto: Impuestos = new Impuestos({\n      TotalImpuestosRetenidos: '1000',\n    });\n    impuesto.traslados({\n      Base: 1,\n      Impuesto: '002',\n      TipoFactor: 'Tasa',\n      TasaOCuota: '0.16',\n      Importe: '59.17',\n    });\n    impuesto.retenciones({\n      Impuesto: '002',\n      Importe: '59.17',\n    });\n    await cfd.impuesto(impuesto);\n\n    // await cfd.certificar(cer);\n    // await cfd.sellar(key, '12345678a');\n    const json = await cfd.getJsonCdfi();\n    const xml = await cfd.getXmlCdfi();\n    // console.log(xml)\n    // console.log(json)\n    // return json;\n\n    // const download = Buffer.from(await Receip.getBase64(), 'base64');\n    // res.contentType('application/pdf');\n    // @ts-ignore\n    if (req.query.xml) {\n      res.set('Content-Type', 'text/xml');\n      // console.log(xml)\n      res.send(xml);\n    } else {\n      res.send(json);\n    }\n  })\n);\napp.listen(1500, () => {\n  console.log('App is listening on port 1500!');\n});\n"]}